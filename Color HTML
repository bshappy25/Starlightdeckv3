<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>URANIUM</title>

<style>
:root{
  --ink1:#050714;
  --ink2:#0e132b;
  --ink3:#1c2038;

  --ether-ink:#ffffff;
  --ether-starlight:#e6e0ff;
  --ether-lavender:#c8bfff;
  --ether-cyan:#7fe3ff;
  --ether-rose:#f7a8c9;
  --ether-gold:#f5e39a;

  --panel:rgba(255,255,255,0.06);
  --border:rgba(255,255,255,0.14);
  --text:rgba(255,255,255,0.92);
  --muted:rgba(255,255,255,0.65);
}

*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  background:
    radial-gradient(900px 600px at 20% 10%, rgba(160,180,255,.08), transparent),
    linear-gradient(180deg,var(--ink1),var(--ink2),var(--ink3));
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  color:var(--text);
}

.wrap{
  width:min(980px,96vw);
  padding:18px 0 28px;
  display:flex;
  flex-direction:column;
  gap:14px;
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.title{
  font-weight:900;
  letter-spacing:.12em;
  font-size:.95rem;
}

.subtitle{
  font-size:.85rem;
  color:var(--muted);
}

.panel{
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  gap:10px;
  padding:12px;
  border-radius:16px;
  background:var(--panel);
  border:1px solid var(--border);
  backdrop-filter:blur(8px);
}

.swatch{
  width:28px;height:28px;border-radius:50%;
  border:1px solid rgba(255,255,255,.35);
  cursor:pointer;
}

.swatch[data-color="black"]{
  background:#000;
  clip-path:polygon(
    50% 0%,61% 35%,98% 35%,68% 57%,
    79% 91%,50% 70%,21% 91%,32% 57%,
    2% 35%,39% 35%
  );
}

.range{width:120px}

button{
  border:none;
  border-radius:14px;
  padding:10px 14px;
  cursor:pointer;
  background:rgba(255,255,255,.1);
  color:var(--text);
  border:1px solid var(--border);
}

.save-light{
  box-shadow:
    0 0 10px rgba(180,220,255,.18),
    0 0 28px rgba(180,220,255,.12);
  animation:pulse 2.4s ease-in-out infinite;
}

@keyframes pulse{
  50%{
    box-shadow:
      0 0 16px rgba(200,240,255,.32),
      0 0 42px rgba(200,240,255,.22);
  }
}

/* ✅ CLEAR X (added) */
.clear-x{
  margin-left:auto;
  width:36px;
  height:36px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:0;
  font-size:1.35rem;
  font-weight:800;
  line-height:1;
  background:rgba(255,255,255,.06);
  border:1px solid var(--border);
  color:var(--text);
}
.clear-x:hover{ background:rgba(255,255,255,.12); }
.clear-x:active{ transform:scale(.96); }

.stage{
  margin:0 auto;
  padding:10px;
  border-radius:18px;
  background:rgba(255,255,255,.03);
  border:1px solid var(--border);
}

canvas{
  width:100%;
  height:min(68vh,560px);
  border-radius:14px;
  background:#0b0e1a;
  display:block;
  touch-action:none;

  /* ✅ MAGIC WAND CURSOR (canvas only) */
  cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'><path d='M7 25 L22 10' stroke='%237fe3ff' stroke-width='3' stroke-linecap='round'/><path d='M20 8 L24 12' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' opacity='0.9'/><circle cx='24' cy='8' r='2' fill='%237fe3ff'/><circle cx='26.5' cy='12' r='1.5' fill='%23ffffff' opacity='0.9'/></svg>") 4 28, auto;
}

.footer{
  font-size:.8rem;
  color:var(--muted);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

/* MODALS */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:20;
}

.modal .box{
  background:#fff;
  color:#000;
  padding:22px;
  border-radius:18px;
  width:min(420px,90vw);
  text-align:center;
}

.modal input{
  width:100%;
  padding:14px;
  margin:12px 0;
  font-size:1.1rem;
  border-radius:12px;
  border:2px solid #7b8cff;
}

.modal button{
  margin:6px;
  padding:12px 18px;
  font-size:1rem;
}

.green{background:#56d364;color:#fff}
.gray{background:#9aa0a6;color:#fff}
</style>
</head>

<body>
<div class="wrap">

  <div class="header">
    <div>
      <div class="title">URANIUM</div>
      <div class="subtitle" id="subtitle"></div>
    </div>
    <button onclick="location.href='https://starlightdeckv3.streamlit.app'">Back to Hub</button>
  </div>

  <div class="panel">
    <div>Light</div>

    <div class="swatch" data-color="--ether-ink" style="background:var(--ether-ink)"></div>
    <div class="swatch" data-color="--ether-starlight" style="background:var(--ether-starlight)"></div>
    <div class="swatch" data-color="--ether-lavender" style="background:var(--ether-lavender)"></div>
    <div class="swatch" data-color="--ether-cyan" style="background:var(--ether-cyan)"></div>
    <div class="swatch" data-color="--ether-rose" style="background:var(--ether-rose)"></div>
    <div class="swatch" data-color="--ether-gold" style="background:var(--ether-gold)"></div>
    <div class="swatch" data-color="black"></div>

    <input id="size" class="range" type="range" min="2" max="40" value="8">
    <span id="sizeLabel">8</span>

    <button class="save-light" id="saveBtn">Save Light</button>

    <!-- ✅ CLEAR BUTTON (added, far right) -->
    <button id="clearBtn" class="clear-x" type="button" aria-label="Clear canvas">×</button>
  </div>

  <div class="stage">
    <canvas id="c"></canvas>
  </div>

  <div class="footer">
    <div>Ȼ <span id="careon">0000</span></div>
    <div>hold light slowly to intensify glow</div>
  </div>
</div>

<!-- SIGNATURE MODAL -->
<div class="modal" id="sigModal">
  <div class="box">
    <h2>✍️ Sign Your Masterpiece</h2>
    <p>Add a signature (optional)</p>
    <input id="sigInput" placeholder="Your signature…">
    <div>
      <button class="green" onclick="confirmSave()">Add Signature & Save</button>
      <button class="gray" onclick="skipSave()">Skip & Save</button>
    </div>
  </div>
</div>

<!-- TOKEN MODAL -->
<div class="modal" id="tokenModal">
  <div class="box">
    <h2>✨ LIGHT UNLOCKED</h2>
    <p>Your Careon Token:</p>
    <h1>LIGHT-0000</h1>
    <button onclick="closeToken()">Continue</button>
  </div>
</div>

<script>
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");
const sizeInput=document.getElementById("size");
const sizeLabel=document.getElementById("sizeLabel");
const saveBtn=document.getElementById("saveBtn");
const clearBtn=document.getElementById("clearBtn"); // ✅ added

let brushColor=getComputedStyle(document.documentElement).getPropertyValue('--ether-ink').trim();
let isBlack=false;
let drawing=false,last={x:0,y:0},lastTime=0;

const subtitles=[
"latent light","slow light, held","quiet energy",
"draw what glows","held radiation","soft decay",
"controlled glow","intentional emission"
];
document.getElementById("subtitle").textContent =
subtitles[Math.floor(Math.random()*subtitles.length)];

function resize(){
 const r=canvas.getBoundingClientRect(),d=window.devicePixelRatio||1;
 canvas.width=r.width*d;canvas.height=r.height*d;
 ctx.fillStyle="#0b0e1a";ctx.fillRect(0,0,canvas.width,canvas.height);
}
window.addEventListener("resize",resize);resize();

document.querySelectorAll(".swatch").forEach(s=>{
 s.onclick=()=>{
  isBlack=s.dataset.color==="black";
  brushColor=isBlack?"#000":
   getComputedStyle(document.documentElement).getPropertyValue(s.dataset.color).trim();
 };
});

sizeInput.oninput=()=>sizeLabel.textContent=sizeInput.value;

function pt(e){
 const r=canvas.getBoundingClientRect(),d=window.devicePixelRatio||1;
 const x=(e.touches?e.touches[0].clientX:e.clientX)-r.left;
 const y=(e.touches?e.touches[0].clientY:e.clientY)-r.top;
 return{x:x*d,y:y*d};
}

function start(e){
 drawing=true;last=pt(e);lastTime=performance.now();e.preventDefault();
}

function move(e){
 if(!drawing)return;
 const p=pt(e),now=performance.now();
 const speed=Math.max(0.2,(now-lastTime)/16);
 ctx.lineCap="round";ctx.lineJoin="round";
 ctx.strokeStyle=brushColor;
 ctx.lineWidth=isBlack?sizeInput.value*speed:sizeInput.value;
 ctx.shadowColor=brushColor;
 ctx.shadowBlur=isBlack?0:20*speed;
 ctx.beginPath();ctx.moveTo(last.x,last.y);ctx.lineTo(p.x,p.y);ctx.stroke();
 last=p;lastTime=now;e.preventDefault();
}

function end(){drawing=false}

canvas.addEventListener("mousedown",start);
canvas.addEventListener("mousemove",move);
window.addEventListener("mouseup",end);
canvas.addEventListener("touchstart",start,{passive:false});
canvas.addEventListener("touchmove",move,{passive:false});
canvas.addEventListener("touchend",end);

let pending=false;
saveBtn.onclick=()=>{pending=true;document.getElementById("sigModal").style.display="flex"}

// ✅ CLEAR logic (added): reset to base dark
clearBtn.onclick=()=>{
 ctx.clearRect(0,0,canvas.width,canvas.height);
 ctx.fillStyle="#0b0e1a";
 ctx.fillRect(0,0,canvas.width,canvas.height);
};

function exportImage(sig){
 const out=document.createElement("canvas");
 out.width=canvas.width;out.height=canvas.height;
 const o=out.getContext("2d");
 const g=o.createLinearGradient(0,0,0,out.height);
 g.addColorStop(0,"#050714");g.addColorStop(1,"#2b2f3a");
 o.fillStyle=g;o.fillRect(0,0,out.width,out.height);
 o.drawImage(canvas,0,0);
 if(sig){
  o.font=`${out.width*0.03}px cursive`;
  o.fillStyle="rgba(255,255,255,.7)";
  o.textAlign="right";
  o.fillText(sig,out.width-24,out.height-24);
 }
 const d=new Date();
 const f=`uranium_${d.getFullYear()}_${String(d.getMonth()+1).padStart(2,"0")}_${String(d.getDate()).padStart(2,"0")}.png`;
 const a=document.createElement("a");
 a.download=f;a.href=out.toDataURL();a.click();

 let c=Number(localStorage.getItem("saves")||0)+1;
 localStorage.setItem("saves",c);
 if(c>=3)document.getElementById("tokenModal").style.display="flex";
}

function confirmSave(){
 exportImage(document.getElementById("sigInput").value);
 document.getElementById("sigModal").style.display="none";
}

function skipSave(){
 exportImage("");
 document.getElementById("sigModal").style.display="none";
}

function closeToken(){
 document.getElementById("tokenModal").style.display="none";
}
</script>
</body>
</html>

