<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sandbox A â€” Paint With Light</title>

  <!-- ðŸŸ¢ STYLE ZONE -->
  <style>
    :root{
      --ink1:#050714;
      --ink2:#0a1030;
      --panel: rgba(255,255,255,0.06);
      --panel-border: rgba(255,255,255,0.12);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.70);
    }

    /* Save Light button */
    .save-light{
      position: relative;
      background: rgba(210, 230, 255, 0.10);
      border: 1px solid rgba(255,255,255,0.18);
      box-shadow:
        0 0 10px rgba(180,220,255,0.18),
        0 0 22px rgba(180,220,255,0.10);
      animation: savePulse 2.2s ease-in-out infinite;
    }

    @keyframes savePulse{
      0%, 100%{
        box-shadow:
          0 0 10px rgba(180,220,255,0.16),
          0 0 22px rgba(180,220,255,0.08);
      }
      50%{
        box-shadow:
          0 0 14px rgba(200,240,255,0.28),
          0 0 34px rgba(200,240,255,0.16);
      }
    }

    /* Mobile: keep stage centered + comfortable */
    .stage{
      margin: 0 auto;
    }

    @media (max-width: 520px){
      canvas{
        height: 62vh;
      }
    }

    .clear-x{
      margin-left:auto;
      width:36px;
      height:36px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.2rem;
      font-weight:700;
      line-height:1;
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.18);
      color: rgba(255,255,255,0.8);
    }

    .clear-x:hover{
      background: rgba(255,255,255,0.12);
    }

    .clear-x:active{
      transform: scale(0.96);
    }

    .color-swatch{
      width:28px;
      height:28px;
      border-radius:50%;
      border:1px solid rgba(255,255,255,0.35);
      cursor:pointer;
      box-shadow: 0 0 6px rgba(255,255,255,0.25);
    }

    .color-swatch:hover{
      transform: scale(1.05);
    }

    body{
      margin:0;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(120,180,255,0.12), transparent 60%),
        radial-gradient(900px 600px at 80% 0%, rgba(180,120,255,0.10), transparent 55%),
        linear-gradient(180deg, var(--ink1), var(--ink2));
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    .wrap{
      width:min(980px, 96vw);
      margin:18px auto 28px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .title{
      letter-spacing:0.08em;
      font-weight:800;
      font-size:0.95rem;
      opacity:0.95;
    }

    .subtitle{
      margin-top:4px;
      color:var(--muted);
      font-size:0.9rem;
    }

    /* ðŸŸ¢ UI PANEL */
    .panel{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      padding:12px 12px;
      border-radius:16px;
      background: var(--panel);
      border: 1px solid var(--panel-border);
      backdrop-filter: blur(8px);
    }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:14px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.18);
      color: var(--muted);
      font-size:0.88rem;
    }

    .pill input[type="color"]{
      width:36px;
      height:28px;
      border:none;
      background:transparent;
      padding:0;
    }

    .pill input[type="range"]{
      width:120px;
    }

    button{
      appearance:none;
      border:none;
      cursor:pointer;
      padding:10px 12px;
      border-radius:14px;
      background: rgba(255,255,255,0.10);
      color: var(--text);
      border:1px solid rgba(255,255,255,0.14);
      font-weight:650;
      letter-spacing:0.02em;
    }

    button:active{
      transform: translateY(1px);
    }

    /* CANVAS */
    .stage{
      border-radius:18px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.03);
      padding:10px;
    }

    canvas{
      display:block;
      width:100%;
      height: min(70vh, 560px);
      background:#ffffff;
      border-radius:14px;
      touch-action:none;
    }

    .footer{
      color: var(--muted);
      font-size:0.85rem;
      text-align:left;
      padding: 2px 4px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div>
      <div class="title">âœ¨ SANDBOX A â€” PAINT WITH LIGHT</div>
      <div class="subtitle">Minimal. Calm. One change at a time.</div>
    </div>

    <div class="panel">
      <div class="pill">
        <span>Light</span>

        <div class="color-swatch" data-color="var(--ether-ink)" style="background:var(--ether-ink)"></div>
        <div class="color-swatch" data-color="var(--ether-starlight)" style="background:var(--ether-starlight)"></div>
        <div class="color-swatch" data-color="var(--ether-lavender)" style="background:var(--ether-lavender)"></div>
        <div class="color-swatch" data-color="var(--ether-cyan)" style="background:var(--ether-cyan)"></div>
        <div class="color-swatch" data-color="var(--ether-rose)" style="background:var(--ether-rose)"></div>
        <div class="color-swatch" data-color="var(--ether-gold)" style="background:var(--ether-gold)"></div>
      </div>

      <div class="pill">
        <span>Size</span>
        <input id="size" type="range" min="1" max="40" value="6" />
        <span id="sizeLabel">6</span>
      </div>

      <button id="clearBtn" class="clear-x" type="button" aria-label="Clear canvas">
        Ã—
      </button>

      <button id="saveBtn" class="save-light" type="button">Save Light</button>
    </div>

    <div class="stage">
      <canvas id="c"></canvas>
    </div>

    <div class="footer">
      Tip: if anything feels unstable, revert to the last working commit.
    </div>
  </div>

  <!-- ðŸŸ¢ LOGIC ZONE -->
  <script>
    const canvas = document.getElementById("c");
    const ctx = canvas.getContext("2d");

    const colorInput = document.getElementById("color");
    const sizeInput  = document.getElementById("size");
    const sizeLabel  = document.getElementById("sizeLabel");
    const clearBtn   = document.getElementById("clearBtn");
    const saveBtn    = document.getElementById("saveBtn");

    let brushColor = getComputedStyle(document.documentElement)
      .getPropertyValue('--ether-ink')
      .trim();

    document.querySelectorAll('.color-swatch').forEach(swatch => {
      swatch.addEventListener('click', () => {
        brushColor = getComputedStyle(document.documentElement)
          .getPropertyValue(
            swatch.dataset.color.replace('var(','').replace(')','')
          )
          .trim();
      });
    });

    let brushSize = Number(sizeInput.value);

    sizeLabel.textContent = brushSize;

    function resizeCanvasToDisplaySize(){
      const rect = canvas.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);

      const w = Math.floor(rect.width * dpr);
      const h = Math.floor(rect.height * dpr);

      if (canvas.width !== w || canvas.height !== h){
        canvas.width = w;
        canvas.height = h;
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }
    }

    window.addEventListener("resize", resizeCanvasToDisplaySize);
    setTimeout(resizeCanvasToDisplaySize, 0);

    colorInput.addEventListener("input", () => {
      brushColor = colorInput.value;
    });

    sizeInput.addEventListener("input", () => {
      brushSize = Number(sizeInput.value);
      sizeLabel.textContent = brushSize;
    });

    clearBtn.addEventListener("click", () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    });

    saveBtn.addEventListener("click", () => {
      // Build filename like: lightpaint_a_2026_02_06.png
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      const filename = `lightpaint_a_${yyyy}_${mm}_${dd}.png`;

      // Create a temp canvas so the exported PNG has an ink/grey gradient behind the art
      const out = document.createElement("canvas");
      out.width = canvas.width;
      out.height = canvas.height;

      const octx = out.getContext("2d");

      // Grey/ink vertical gradient (calm backdrop for pastel lines)
      const g = octx.createLinearGradient(0, 0, 0, out.height);
      g.addColorStop(0, "#0a0f24");  // ink top
      g.addColorStop(1, "#2b2f3a");  // smoky grey bottom
      octx.fillStyle = g;
      octx.fillRect(0, 0, out.width, out.height);

      // Draw the user's current canvas on top
      octx.drawImage(canvas, 0, 0);

      const link = document.createElement("a");
      link.download = filename;
      link.href = out.toDataURL("image/png");
      link.click();
    });

    let drawing = false;
    let last = { x: 0, y: 0 };

    function getPoint(e){
      const rect = canvas.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);

      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;

      return {
        x: (clientX - rect.left) * dpr,
        y: (clientY - rect.top) * dpr
      };
    }

    function start(e){
      resizeCanvasToDisplaySize();
      drawing = true;
      last = getPoint(e);
      e.preventDefault();
    }

    function move(e){
      if (!drawing) return;

      const p = getPoint(e);

      ctx.lineCap = "round";
      ctx.lineJoin = "round";
      ctx.strokeStyle = brushColor;
      ctx.lineWidth = brushSize;

      ctx.beginPath();
      ctx.moveTo(last.x, last.y);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();

      last = p;
      e.preventDefault();
    }

    function end(){
      drawing = false;
    }

    canvas.addEventListener("mousedown", start);
    window.addEventListener("mousemove", move);
    window.addEventListener("mouseup", end);

    canvas.addEventListener("touchstart", start, { passive:false });
    canvas.addEventListener("touchmove", move, { passive:false });
    canvas.addEventListener("touchend", end);
  </script>
</body>
</html>

