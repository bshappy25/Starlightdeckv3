<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sandbox A â€” Paint With Light</title>

  <!-- ðŸŸ¢ STYLE ZONE -->
  <style>
    :root{
      --ink1:#050714;
      --ink2:#0a1030;
      --panel: rgba(255,255,255,0.06);
      --panel-border: rgba(255,255,255,0.12);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.70);

      /* Ethereal palette (swatches use these) */
      --ether-ink: #0f1224;
      --ether-starlight: #f5f7ff;
      --ether-lavender: #c9c2ff;
      --ether-cyan: #8fe3ff;
      --ether-rose: #f2a6c9;
      --ether-gold: #ffd89e;

      /* Black (shape-stamp mode) */
      --ether-black: #111111;
    }

    /* Save Light button */
    .save-light{
      position: relative;
      background: rgba(210, 230, 255, 0.10);
      border: 1px solid rgba(255,255,255,0.18);
      box-shadow:
        0 0 10px rgba(180,220,255,0.18),
        0 0 22px rgba(180,220,255,0.10);
      animation: savePulse 2.2s ease-in-out infinite;
    }

    @keyframes savePulse{
      0%, 100%{
        box-shadow:
          0 0 10px rgba(180,220,255,0.16),
          0 0 22px rgba(180,220,255,0.08);
      }
      50%{
        box-shadow:
          0 0 14px rgba(200,240,255,0.28),
          0 0 34px rgba(200,240,255,0.16);
      }
    }

    /* Mobile: keep stage centered + comfortable */
    .stage{
      margin: 0 auto;
    }

    @media (max-width: 520px){
      canvas{
        height: 62vh;
      }
    }

    .clear-x{
      margin-left:auto;
      width:36px;
      height:36px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.2rem;
      font-weight:700;
      line-height:1;
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.18);
      color: rgba(255,255,255,0.8);
    }

    .clear-x:hover{
      background: rgba(255,255,255,0.12);
    }

    .clear-x:active{
      transform: scale(0.96);
    }

    .color-swatch{
      width:28px;
      height:28px;
      border-radius:50%;
      border:1px solid rgba(255,255,255,0.35);
      cursor:pointer;
      box-shadow: 0 0 6px rgba(255,255,255,0.25);
      transition: transform 120ms ease, box-shadow 120ms ease, border-color 120ms ease;
    }

    .color-swatch:hover{
      transform: scale(1.05);
    }

    /* Active ring (S5) */
    .color-swatch.active{
      border-color: rgba(255,255,255,0.85);
      box-shadow:
        0 0 8px rgba(255,255,255,0.28),
        0 0 18px rgba(190,220,255,0.18);
    }

    body{
      margin:0;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(120,180,255,0.12), transparent 60%),
        radial-gradient(900px 600px at 80% 0%, rgba(180,120,255,0.10), transparent 55%),
        linear-gradient(180deg, var(--ink1), var(--ink2));
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    .wrap{
      width:min(980px, 96vw);
      margin:18px auto 28px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .title{
      letter-spacing:0.08em;
      font-weight:800;
      font-size:0.95rem;
      opacity:0.95;
    }

    .subtitle{
      margin-top:4px;
      color:var(--muted);
      font-size:0.9rem;
    }

    /* ðŸŸ¢ UI PANEL */
    .panel{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      padding:12px 12px;
      border-radius:16px;
      background: var(--panel);
      border: 1px solid var(--panel-border);
      backdrop-filter: blur(8px);
    }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:14px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.18);
      color: var(--muted);
      font-size:0.88rem;
    }

    .pill input[type="range"]{
      width:120px;
    }

    button{
      appearance:none;
      border:none;
      cursor:pointer;
      padding:10px 12px;
      border-radius:14px;
      background: rgba(255,255,255,0.10);
      color: var(--text);
      border:1px solid rgba(255,255,255,0.14);
      font-weight:650;
      letter-spacing:0.02em;
    }

    button:active{
      transform: translateY(1px);
    }

    /* Shape buttons (black-only stamping) */
    .shape-btn{
      padding:8px 10px;
      border-radius:12px;
      font-weight:700;
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.14);
      color: rgba(255,255,255,0.85);
    }

    .shape-btn.active{
      background: rgba(255,255,255,0.14);
      border-color: rgba(255,255,255,0.28);
      color: rgba(255,255,255,0.95);
    }

    /* CANVAS */
    .stage{
      border-radius:18px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.03);
      padding:10px;
    }

    canvas{
      display:block;
      width:100%;
      height: min(70vh, 560px);
      background:#ffffff;
      border-radius:14px;
      touch-action:none;
    }

    .footer{
      color: var(--muted);
      font-size:0.85rem;
      text-align:left;
      padding: 2px 4px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div>
      <div class="title">âœ¨ SANDBOX A â€” PAINT WITH LIGHT</div>
      <div class="subtitle">Minimal. Calm. One change at a time.</div>
    </div>

    <div class="panel">
      <div class="pill">
        <span>Light</span>

        <!-- S3 order -->
        <div class="color-swatch active" data-color="var(--ether-ink)" style="background:var(--ether-ink)"></div>
        <div class="color-swatch" data-color="var(--ether-starlight)" style="background:var(--ether-starlight)"></div>
        <div class="color-swatch" data-color="var(--ether-lavender)" style="background:var(--ether-lavender)"></div>
        <div class="color-swatch" data-color="var(--ether-cyan)" style="background:var(--ether-cyan)"></div>
        <div class="color-swatch" data-color="var(--ether-rose)" style="background:var(--ether-rose)"></div>
        <div class="color-swatch" data-color="var(--ether-gold)" style="background:var(--ether-gold)"></div>

        <!-- Black (shape-stamp mode) -->
        <div class="color-swatch" data-color="var(--ether-black)" style="background:var(--ether-black)"></div>
      </div>

      <div class="pill">
        <span>Size</span>
        <input id="size" type="range" min="1" max="40" value="6" />
        <span id="sizeLabel">6</span>
      </div>

      <!-- S1: dim/enhance light -->
      <div class="pill">
        <span>Light+</span>
        <input id="light" type="range" min="0.20" max="1.00" step="0.05" value="0.85" />
        <span id="lightLabel">0.85</span>
      </div>

      <!-- S2: black only as shapes -->
      <div class="pill">
        <span>Shape</span>
        <button class="shape-btn active" data-shape="square" type="button">â–¡</button>
        <button class="shape-btn" data-shape="circle" type="button">â—‹</button>
        <button class="shape-btn" data-shape="star" type="button">â˜…</button>
        <button class="shape-btn" data-shape="pentagon" type="button">â¬Ÿ</button>
      </div>

      <button id="clearBtn" class="clear-x" type="button" aria-label="Clear canvas">
        Ã—
      </button>

      <button id="saveBtn" class="save-light" type="button">Save Light</button>
    </div>

    <div class="stage">
      <canvas id="c"></canvas>
    </div>

    <div class="footer">
      Tip: if anything feels unstable, revert to the last working commit.
    </div>
  </div>

  <!-- ðŸŸ¢ LOGIC ZONE -->
  <script>
    const canvas = document.getElementById("c");
    const ctx = canvas.getContext("2d");

    const sizeInput  = document.getElementById("size");
    const sizeLabel  = document.getElementById("sizeLabel");

    const lightInput = document.getElementById("light");
    const lightLabel = document.getElementById("lightLabel");

    const clearBtn   = document.getElementById("clearBtn");
    const saveBtn    = document.getElementById("saveBtn");

    // Brush state
    let brushSize = Number(sizeInput.value);
    sizeLabel.textContent = brushSize;

    let brushAlpha = Number(lightInput.value);
    lightLabel.textContent = brushAlpha.toFixed(2);

    // Color state (default: ether-ink)
    const rootStyle = getComputedStyle(document.documentElement);
    const blackHex = rootStyle.getPropertyValue('--ether-black').trim();

    let brushColor = rootStyle.getPropertyValue('--ether-ink').trim();

    // Shape state (black-only stamping)
    let shapeMode = "square";

    // Swatch click: set brushColor + active ring (S5)
    const swatches = Array.from(document.querySelectorAll('.color-swatch'));
    swatches.forEach(swatch => {
      swatch.addEventListener('click', () => {
        swatches.forEach(s => s.classList.remove('active'));
        swatch.classList.add('active');

        const varName = swatch.dataset.color.replace('var(','').replace(')','');
        brushColor = getComputedStyle(document.documentElement)
          .getPropertyValue(varName)
          .trim();
      });
    });

    // Shape button selection
    const shapeBtns = Array.from(document.querySelectorAll('.shape-btn'));
    shapeBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        shapeBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        shapeMode = btn.dataset.shape;
      });
    });

    // UI controls
    sizeInput.addEventListener("input", () => {
      brushSize = Number(sizeInput.value);
      sizeLabel.textContent = brushSize;
    });

    lightInput.addEventListener("input", () => {
      brushAlpha = Number(lightInput.value);
      lightLabel.textContent = brushAlpha.toFixed(2);
    });

    // Canvas sizing
    function resizeCanvasToDisplaySize(){
      const rect = canvas.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);

      const w = Math.floor(rect.width * dpr);
      const h = Math.floor(rect.height * dpr);

      if (canvas.width !== w || canvas.height !== h){
        canvas.width = w;
        canvas.height = h;
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }
    }

    window.addEventListener("resize", resizeCanvasToDisplaySize);
    setTimeout(resizeCanvasToDisplaySize, 0);

    // Clear
    clearBtn.addEventListener("click", () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    });

    // Save (ink/grey gradient baked behind)
    saveBtn.addEventListener("click", () => {
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      const filename = `lightpaint_a_${yyyy}_${mm}_${dd}.png`;

      const out = document.createElement("canvas");
      out.width = canvas.width;
      out.height = canvas.height;

      const octx = out.getContext("2d");

      const g = octx.createLinearGradient(0, 0, 0, out.height);
      g.addColorStop(0, "#0a0f24");  // ink top
      g.addColorStop(1, "#2b2f3a");  // smoky grey bottom
      octx.fillStyle = g;
      octx.fillRect(0, 0, out.width, out.height);

      octx.drawImage(canvas, 0, 0);

      const link = document.createElement("a");
      link.download = filename;
      link.href = out.toDataURL("image/png");
      link.click();
    });

    // Shape drawing helpers (black-only)
    function polygonPath(cx, cy, radius, sides, rotation = -Math.PI / 2){
      ctx.beginPath();
      for (let i = 0; i < sides; i++){
        const a = rotation + (i * 2 * Math.PI / sides);
        const x = cx + radius * Math.cos(a);
        const y = cy + radius * Math.sin(a);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.closePath();
    }

    function starPath(cx, cy, outerR, innerR, points = 5, rotation = -Math.PI / 2){
      ctx.beginPath();
      const step = Math.PI / points;
      for (let i = 0; i < points * 2; i++){
        const r = (i % 2 === 0) ? outerR : innerR;
        const a = rotation + i * step;
        const x = cx + r * Math.cos(a);
        const y = cy + r * Math.sin(a);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.closePath();
    }

    function stampShape(x, y){
      const s = Math.max(6, brushSize * 3); // stamp size tied to brush size
      ctx.save();
      ctx.globalAlpha = Math.min(1, Math.max(0.05, brushAlpha));
      ctx.fillStyle = blackHex;

      if (shapeMode === "square"){
        ctx.beginPath();
        ctx.rect(x - s/2, y - s/2, s, s);
        ctx.fill();
      } else if (shapeMode === "circle"){
        ctx.beginPath();
        ctx.arc(x, y, s/2, 0, Math.PI * 2);
        ctx.fill();
      } else if (shapeMode === "pentagon"){
        polygonPath(x, y, s/2, 5);
        ctx.fill();
      } else if (shapeMode === "star"){
        starPath(x, y, s/2, (s/2) * 0.45, 5);
        ctx.fill();
      }

      ctx.restore();
    }

    // Drawing
    let drawing = false;
    let last = { x: 0, y: 0 };

    function getPoint(e){
      const rect = canvas.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);

      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;

      return {
        x: (clientX - rect.left) * dpr,
        y: (clientY - rect.top) * dpr
      };
    }

    function start(e){
      resizeCanvasToDisplaySize();
      const p = getPoint(e);

      // If black is selected: stamp shapes only (S2)
      if (brushColor === blackHex){
        stampShape(p.x, p.y);
        e.preventDefault();
        return;
      }

      drawing = true;
      last = p;
      e.preventDefault();
    }

    function move(e){
      if (!drawing) return;

      const p = getPoint(e);

      ctx.save();
      ctx.globalAlpha = Math.min(1, Math.max(0.05, brushAlpha));
      ctx.lineCap = "round";
      ctx.lineJoin = "round";
      ctx.strokeStyle = brushColor;
      ctx.lineWidth = brushSize;

      ctx.beginPath();
      ctx.moveTo(last.x, last.y);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();
      ctx.restore();

      last = p;
      e.preventDefault();
    }

    function end(){
      drawing = false;
    }

    // Mouse
    canvas.addEventListener("mousedown", start);
    window.addEventListener("mousemove", move);
    window.addEventListener("mouseup", end);

    // Touch
    canvas.addEventListener("touchstart", start, { passive:false });
    canvas.addEventListener("touchmove", move, { passive:false });
    canvas.addEventListener("touchend", end);
  </script>
</body>
</html>

